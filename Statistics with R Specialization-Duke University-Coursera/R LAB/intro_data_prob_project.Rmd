---
title: "Exploring the BRFSS data"
output: 
  html_document: 
    fig_height: 4
    highlight: pygments
    theme: spacelab
---

## Setup

### Load packages

```{r load-packages, message = FALSE}
library(ggplot2)
library(dplyr)
```

### Load data

Make sure your data and R Markdown files are in the same directory. When loaded
your data file will be called `brfss2013`. Delete this note when before you submit 
your work. 

```{r load-data}
load("brfss2013.RData")
```


* * *
## Part 1: Data
The Behavioral Risk Factor Surveillance System (BRFSS) is a collaborative project between all of the states in the United States (US) and participating US territories and the Centers for Disease Control and Prevention (CDC). The BRFSS is administered and supported by CDC's Population Health Surveillance Branch, under the Division of Population Health at the National Center for Chronic Disease Prevention and Health Promotion. 

BRFSS is an ongoing surveillance system designed to measure behavioral risk factors for the non-institutionalized adult population (18 years of age and older) residing in the US. The BRFSS was initiated in 1984, with 15 states collecting surveillance data on risk behaviors through monthly telephone interviews. 

Over time, the number of states participating in the survey increased; by 2001, 50 states, the District of Columbia, Puerto Rico, Guam, and the US Virgin Islands were participating in the BRFSS. Today, all 50 states, the District of Columbia, Puerto Rico, and Guam collect data annually and American Samoa, Federated States of Micronesia, and Palau collect survey data over a limited point- in-time (usually one to three months). In this document, the term "state" is used to refer to all areas participating in BRFSS, including the District of Columbia, Guam, and the Commonwealth of Puerto Rico.

The BRFSS objective is to collect uniform, state-specific data on preventive health practices and risk behaviors that are linked to chronic diseases, injuries, and preventable infectious diseases that affect the adult population. Factors assessed by the BRFSS in 2013 include tobacco use, HIV/AIDS knowledge and prevention, exercise, immunization, health status, healthy days - health-related quality of life, health care access, inadequate sleep, hypertension awareness, cholesterol awareness, chronic health conditions, alcohol consumption, fruits and vegetables consumption, arthritis burden, and seatbelt use. Since 2011, BRFSS conducts both landline telephone- and cellular telephone-based surveys. In conducting the BRFSS landline telephone survey, interviewers collect data from a randomly selected adult in a household. In conducting the cellular telephone version of the BRFSS questionnaire, interviewers collect data from an adult who participates by using a cellular telephone and resides in a private residence or college housing.

Health characteristics estimated from the BRFSS pertain to the non-institutionalized adult population, aged 18 years or older, who reside in the US. In 2013, additional question sets were included as optional modules to provide a measure for several childhood health and wellness indicators, including asthma prevalence for people aged 17 years or younger.


* * *

## Part 2: Research questions

**Research quesion 1:**
Analysis from main survey - Section 2 - Healthy Days 
Health-Related Quality of Life

Variables will be used are:

    physhlth: Number Of Days Physical Health Not Good
    menthlth: Number Of Days Mental Health Not Good
    poorhlth: Poor Physical Or Mental Health

My 1st research question is:

how health conditions are distributed.

**Research quesion 2:**
Second, I would like to see if there exists any relation between how many hours one sleeps and certain health conditions such as Heart Attack, Depressive Disorder etc.

Variables will be used are:

    sleptim1: How Much Time Do You Sleep
    cvdinfr4: Ever Diagnosed With Heart Attack
    addepev2: Ever Told You Had A Depressive Disorder

What I am going to do is:
   
   Will run an initial correlation analysis among these variables.

**Research quesion 3:**

Third, I would like to see if health condition such as Heart Attack can be predicted using sleep time, Cholesterol, blood pressure etc.

Variables I am using here  are:

    cvdinfr4: Ever Diagnosed With Heart Attack
    bloodcho: Ever Had Blood Cholesterol Checked
    cholchk: How Long Since Cholesterol Checked
    toldhi2: Ever Told Blood Cholesterol High
    bphigh4: Ever Told Blood Pressure High
    sleptim1: How Much Time Do You Sleep

What I will be doing is:
   
   Run a basic generalized linear regression analysis among these variables.


* * *

## Part 3: Exploratory data analysis

NOTE: Insert code chunks as needed by clicking on the "Insert a new code chunk" 
button (green button with orange arrow) above. Make sure that your code is visible
in the project you submit. Delete this note when before you submit your work.

**Research quesion 1:**

```{r}
# op <- par(mfrow = c(2, 2))
hist(brfss2013$physhlth, main="Histogram-Physical Health", xlab="Physical Health")
```

```{r}
hist(brfss2013$menthlth, main="Histogram-Mental Health", xlab="Mental Health")
```
```{r}
hist(brfss2013$poorhlth, main="Histogram-Health", xlab="Poor Physical Or Mental Health")
```
```{r}
# par(op)
```


**Research quesion 2:**

```{r}
# Create a subset of data
vars <- names(brfss2013) %in% c("sleptim1", "cvdinfr4", "addepev2")
subdata <- brfss2013[vars]
# make a backup
subdata1 <- subdata
# conver factor levels into numeric levels
subdata1$addepev2 <- ifelse(subdata$addepev2=="Yes", 1, 0)
subdata1$cvdinfr4 <- ifelse(subdata$cvdinfr4=="Yes", 1, 0)
# remove rows containing NAs
library(Hmisc)
```



**Research quesion 3:**

```{r}
subdata1 <- na.delete(subdata1)
# find correlation
cor(subdata1)
```
Plotting correlations
```{r}
library(corrplot)
M <- cor(subdata1)
corrplot(M, method="ellipse")
```
From the above results we can say that:

   1. Sleep time and Depressive Disorder has negative correlation, that means if one sleeps less, chances for Depressive Disorder go high (this is not a causation, but just an initial inference). 
   2. Sleep time and Ever Diagnosed With Heart Attack shows almost no relation among them (corerlation is almost zero)

This can further be explored in subsequent in depth analysis.

**Research quesion 3:**
Data Prepration
```{r}
# Create a subset of data
vars <- names(brfss2013) %in% c("cvdinfr4", "bloodcho", "toldhi2", "bphigh4", "sleptim1")
subdata <- brfss2013[vars]
```
How Many NAs in each column of the above subdata
```{r}
MissingData <- function(x){sum(is.na(x))/length(x)*100}
apply(subdata, 2, MissingData)
```
# NAs encountered
```{r}
summary(subdata$bloodcho)
```

```{r}
# Replace NA with "No"s
subdata$bloodcho <- replace(subdata$bloodcho, which(is.na(subdata$bloodcho)), "No")
#check replacement
summary(subdata$bloodcho)
```

```{r}
summary(subdata$bphigh4)
```

```{r}
# Replace NA with "No"s
subdata$bphigh4 <- replace(subdata$bphigh4, which(is.na(subdata$bphigh4)), "No")
#check replacement
summary(subdata$bphigh4)
```

```{r}
# Sleep time NA to be replaced with mean of the data
summary(subdata$sleptim1)
```

```{r}
mean(subdata$sleptim1,na.rm = T)
```

```{r}
subdata$sleptim1 <- replace(subdata$sleptim1, which(is.na(subdata$sleptim1)), 7)
#check replacement
summary(subdata$sleptim1)
```

```{r}
summary(subdata$toldhi2)
```

```{r}
subdata$toldhi2 <- replace(subdata$toldhi2, which(is.na(subdata$toldhi2)), "No")
#check replacement
summary(subdata$toldhi2)
```
```{r}
summary(subdata$cvdinfr4)
```

```{r}
subdata$cvdinfr4 <- replace(subdata$cvdinfr4, which(is.na(subdata$cvdinfr4)), "No")
#check replacement
summary(subdata$cvdinfr4)
```

Now, let's look into the High BP data
```{r}
# Make a copy of the data
subdata1 <- subdata
# table the data
table(subdata1$bphigh4)
```

Here we can see that there are some other factor levels also i.e.

    Yes, but female told only during pregnancy  -  2647 cases
    
    Told borderline or pre-hypertensive - 4467 cases

I will treat both the cases as "YES" (excuse me), because I guess they are High BloddPressure cases, almost.

Hence, let's prepare our data again.

```{r}
# COnverting factor levels into proper factor levels
subdata1$bphigh4 <- as.factor(ifelse(subdata1$bphigh4=="Yes", "Yes", 
                           (ifelse(subdata1$bphigh4=="Yes, but female told only during pregnancy", "Yes",
                           (ifelse(subdata1$bphigh4=="Told borderline or pre-hypertensive", "Yes",
                                   "No"))))))
# table the data
summary(subdata1$bphigh4)
```
```{r}
# check class of sub dataset
class(subdata1)
```

Now we will fit the data for logistic regression using binomial method
```{r}
# summarize data
summary(subdata1)
```

```{r}
# Fit the logistic regression
fit <- glm(cvdinfr4 ~ ., data=subdata1, family = "binomial")
```

Summarize the model
```{r}
summary(fit)
```
So from the summary we can say that the model says the sleeping time is insignificant in predicting heart attack conditions while other variables are highly significant.
